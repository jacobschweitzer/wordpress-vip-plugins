!function(e){e(function(){function n(){var n={apiKeyInput:e(".lp_js_validateApiKey"),merchantIdInput:e(".lp_js_validateMerchantId"),apiCredentialsInputs:e(".lp_js_validateApiKey, .lp_js_validateMerchantId"),testMerchantId:e("#lp_js_sandboxMerchantId"),testApiKey:e("#lp_js_sandboxApiKey"),liveMerchantId:e("#lp_js_liveMerchantId"),liveApiKey:e("#lp_js_liveApiKey"),pluginModeIndicator:e("#lp_js_pluginModeIndicator"),pluginModeToggle:e("#lp_js_togglePluginMode"),pluginVisibilitySetting:e("#lp_js_pluginVisibilitySetting"),hasInvalidSandboxCredentials:e("#lp_js_hasInvalidSandboxCredentials"),isLive:"lp_is-live",navigation:e(".lp_navigation"),region:e("#lp_js_apiRegionSection"),regionNoticeBlock:e("#lp_js_regionNotice"),showMerchantContractsButton:e("#lp_js_showMerchantContracts"),apiCredentials:e("#lp_js_apiCredentialsSection"),requestSent:!1,hide_cache_warning:e("#hide_cache_warning"),lp_cache_warning:e("#lp_cache_warning"),lp_account_login:e("#lp_account_login")},i=n.region.val(),t=function(){n.apiKeyInput.bind("input",function(){var e=this;setTimeout(function(){p(e)},50)}),n.merchantIdInput.bind("input",function(){var e=this;setTimeout(function(){d(e)},50)}),n.region.change(function(){c()}),n.pluginModeToggle.change(function(){r()}),n.showMerchantContractsButton.bind("click",function(){return e(this).attr("href",e(this).data("href-"+n.region.val())),!0}),n.lp_account_login.bind("click",function(){return e(this).attr("href",e(this).data("href-"+n.region.val())),!0}),window.onbeforeunload=function(){g()},n.hide_cache_warning.on("click",function(){e.post(lpVars.ajaxUrl,{action:"laterpay_reset_notice_data",security:lpVars.reset_cache_nonce},function(e){e.success&&n.lp_cache_warning.hide()},"json")})},a=function(){for(var e=0,i=n.apiCredentialsInputs.length;e<i;e++)if(""===n.apiCredentialsInputs.eq(e).val())return void n.apiCredentialsInputs.eq(e).focus()},o=function(){u()?(n.hasInvalidSandboxCredentials.val(1),n.pluginVisibilityToggle.prop("checked",!1),n.testMerchantId.focus(),n.showMerchantContractsButton.velocity("fadeIn",{duration:250}),n.requestSent=!1):n.hasInvalidSandboxCredentials.val(0)},l=function(n){"live"===n?e("#lp_js_pluginModeIndicator").velocity("fadeOut",{duration:250}):e("#lp_js_pluginModeIndicator").velocity("fadeIn",{duration:250})},r=function(){var e=n.pluginModeToggle,i=e.prop("checked");u()?(e.prop("checked",!1),n.liveMerchantId.focus(),n.requestSent=!1,n.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"})):i?(n.pluginVisibilitySetting.velocity("fadeOut",{duration:250}),n.showMerchantContractsButton.velocity("fadeOut",{duration:250})):n.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"}),s("laterpay_plugin_mode")},c=function(){var t="laterpay_region";e.post(ajaxurl,e("#"+t).serializeArray(),function(e){n.navigation.showMessage(e),e.success?(i=n.region.val(),n.testMerchantId.val(e.creds.cp_key),n.testApiKey.val(e.creds.api_key),"eu"!==i?n.regionNoticeBlock.removeClass("hidden"):n.regionNoticeBlock.addClass("hidden")):n.region.val(i)},"json"),setTimeout(function(){n.pluginModeToggle.prop("checked")&&_()},2e3)},s=function(i){n.requestSent||(n.requestSent=!0,e.post(ajaxurl,e("#"+i).serializeArray(),function(e){n.navigation.showMessage(e),l(e.mode)},"json").done(function(){if(n.requestSent=!1,"laterpay_plugin_mode"===i){var t=n.pluginModeToggle.prop("checked")?"Live":"Test",a=e("#lp_js_sandboxMerchantId").val(),o=e("#lp_js_liveMerchantId").val();n.pluginModeToggle.prop("checked")&&n.lp_cache_warning.show();var l=a+" | "+o+" | "+lpVars.gaData.site_url+" | ",r="LP WP Account",c="Account Status Change";lpGlobal.sendLPGAEvent(c,r,l+t)}"laterpay_plugin_mode"!==i&&"laterpay_live_merchant_id"!==i&&"laterpay_live_api_key"!==i||setTimeout(function(){n.pluginModeToggle.prop("checked")&&_()},2e3)}))},p=function(i){var t=e(i),a=t.parents("form"),l=t.val().trim(),c=32;if(l.length!==t.val().length&&t.val(l),0===l.length||l.length===c)s(a.attr("id"));else{n.navigation.showMessage(lpVars.i18nApiKeyInvalid,!1);var p=n.testApiKey.parents("form").attr("id");a.attr("id")===p&&o()}u()&&r()},d=function(i){var t=e(i),a=t.parents("form"),l=t.val().trim(),c=22;if(l.length!==t.val().length&&t.val(l),0===l.length||l.length===c)s(a.attr("id"));else{n.navigation.showMessage(lpVars.i18nMerchantIdInvalid,!1);var p=n.testMerchantId.parents("form").attr("id");a.attr("id")===p&&o()}u()&&r()},u=function(){var e=32!==n.liveApiKey.val().length||22!==n.liveMerchantId.val().length;return n.pluginModeToggle.prop("checked")&&e},g=function(){if(u())return lpVars.i18nPreventUnload},_=function(){e.post(lpVars.ajaxUrl,{action:"laterpay_validate_cred_region",security:lpVars.validate_cred_nonce},function(e){e.hasOwnProperty("mode")&&(n.pluginModeToggle.prop("checked",!1),n.navigation.showMessage(e))},"json")},h=function(){t(),a()};h()}n()})}(jQuery);